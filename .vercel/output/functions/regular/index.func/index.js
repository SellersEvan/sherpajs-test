var T=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var x=(r,e)=>{for(var t in e)T(r,t,{get:e[t],enumerable:!0})},J=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of M(e))!_.call(r,s)&&s!==t&&T(r,s,{get:()=>e[s],enumerable:!(o=A(e,s))||o.enumerable});return r};var H=r=>J(T({},"__esModule",{value:!0}),r);var j={};x(j,{default:()=>v});module.exports=H(j);var g;(function(r){r.GET="GET",r.PUT="PUT",r.POST="POST",r.PATCH="PATCH",r.DELETE="DELETE"})(g||(g={}));var P;(function(r){r.Vercel="Vercel",r.Local="Local"})(P||(P={}));var n;(function(r){r.JSON="JSON",r.Text="Text",r.None="None"})(n||(n={}));var R={[n.JSON]:"application/json",[n.Text]:"text/plain",[n.None]:void 0};var E={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot \u{1FAD6}",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};var B={headers:{},status:200},l=class r{static new(e){let t=r.defaultOptions(n.None,e);return{status:t.status,statusText:r.getStatusText(t.status),headers:t.headers,body:void 0,bodyType:n.None}}static text(e,t){let o=r.defaultOptions(n.Text,t);return{status:o.status,statusText:r.getStatusText(o.status),headers:o.headers,body:e,bodyType:n.Text}}static JSON(e,t){let o=r.defaultOptions(n.JSON,t);return{status:o.status,statusText:r.getStatusText(o.status),headers:o.headers,body:e,bodyType:n.JSON}}static redirect(e,t){let o=r.defaultOptions(n.None,t);return{status:302,statusText:r.getStatusText(302),headers:{Location:e,...o.headers},body:void 0,bodyType:n.None}}static defaultOptions(e,t){let o={...B,...t};return o.headers={"Content-Type":R[e],...o.headers},o}static getStatusText(e){let t=E[e];if(!t)throw new Error(`Status code "${e}" is invalid.`);return t}};var d=class{static getPathname(e){let t=this.getInstance(e).pathname;return t=t.replace(/\/\.\//g,"/"),t=t.replace(/\/[^/]+\/\.\.\//g,"/"),t}static getSearchParams(e){return this.getInstance(e).searchParams}static getInstance(e){return e=e.endsWith("/")?e.slice(0,-1):e,new URL(e,"https://example.com")}};var a=class{static getDynamicURL(e){return e.map(t=>t.isDynamic?`[${t.name}]`:t.name).join("/")}static parseHeader(e){let t={};return Object.keys(e).forEach(o=>{t[o]=e[o]}),t}static parseParamsPath(e,t){let o={};return d.getPathname(e).split("/").filter(s=>s!="").forEach((s,u)=>{if(t[u].isDynamic){let p=t[u].name,U=this.parseParam(s);this.setValue(o,p,U)}}),o}static parseParamsQuery(e){let t={};return d.getSearchParams(e).forEach((o,s)=>{this.setValue(t,s,this.parseParam(o))}),t}static setValue(e,t,o){e.hasOwnProperty(t)?Array.isArray(e[t])?e[t].push(...o):e[t]=[e[t],...o]:e[t]=o.length==1?o[0]:o}static parseParam(e){return e.includes(",")?e.split(",").map(t=>this.parseParam(t)).flat():e=="true"?[!0]:e=="false"?[!1]:/^\d+$/.test(e)?[parseInt(e)]:[e]}static getAttribute(e,t){let o=Object.keys(e),s=t.toLowerCase(),u=o.find(p=>p.toLowerCase()===s);return u?e[u]:void 0}};var c=class{static async Local(e,t){if(!e.url||!e.method)throw new Error("Missing URL and Methods");let{body:o,bodyType:s}=await this.parseBodyLocal(e);return{url:d.getPathname(e.url),params:{path:a.parseParamsPath(e.url,t),query:a.parseParamsQuery(e.url)},method:e.method.toUpperCase(),headers:a.parseHeader(e.headers),body:o,bodyType:s}}static parseBodyLocal(e){return new Promise((t,o)=>{let s="",u=n.Text;e.on("data",p=>{s+=p.toString()}),e.on("end",()=>{let p=a.getAttribute(e.headers,"content-type");(!p||s=="")&&t({body:void 0,bodyType:n.None}),p=="application/json"&&(s=JSON.parse(s),u=n.JSON),t({body:s,bodyType:u})}),e.on("error",p=>{t({body:void 0,bodyType:n.None})})})}static async Vercel(e,t){let{body:o,bodyType:s}=await this.parseBodyVercel(e);return{url:d.getPathname(e.url),params:{path:a.parseParamsPath(e.url,t),query:a.parseParamsQuery(e.url)},method:e.method.toUpperCase(),headers:a.parseHeader(e.headers),body:o,bodyType:s}}static async parseBodyVercel(e){console.log(JSON.stringify(e)),console.log(JSON.stringify(e.headers));let t=a.getAttribute(e.headers,"content-type");return t?t=="application/json"?{body:await e.json(),bodyType:n.JSON}:{body:await e.text(),bodyType:n.Text}:{body:void 0,bodyType:n.None}}};var V=Response,m=class{static Local(e,t){t.statusCode=e.status,t.statusMessage=e.statusText;for(let[o,s]of Object.entries(e.headers))s&&t.setHeader(o,s);t.end(this.getBody(e))}static Vercel(e){return new V(this.getBody(e),{headers:e.headers,status:e.status,statusText:e.statusText})}static getBody(e){switch(e.bodyType){case n.Text:return e.body;case n.JSON:return JSON.stringify(e.body)}}};async function N(r,e,t){let o=r[t.method];if(o)try{let s=await o(t,e);return s||l.new({status:200})}catch(s){return l.text(s.message,{status:500})}else return l.new({status:405})}var y={RequestTransform:c,ResponseTransform:m,Handler:N};var S={};x(S,{DELETE:()=>Q,GET:()=>F,PATCH:()=>k,POST:()=>G,PUT:()=>q});var h=class{static server(e){return e}static module(e){return e}},f=class{static module(e){return e}};var b={JSON:"application/json",Text:"text/plain",None:void 0};var O={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot \u{1FAD6}",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};var D={headers:{},status:200},i=class r{static new(e){let t=r.defaultOptions("None",e);return{status:t.status,statusText:r.getStatusText(t.status),headers:t.headers,body:void 0,bodyType:"None"}}static text(e,t){let o=r.defaultOptions("Text",t);return{status:o.status,statusText:r.getStatusText(o.status),headers:o.headers,body:e,bodyType:"Text"}}static JSON(e,t){let o=r.defaultOptions("JSON",t);return{status:o.status,statusText:r.getStatusText(o.status),headers:o.headers,body:e,bodyType:"JSON"}}static redirect(e,t){let o=r.defaultOptions("None",t);return{status:302,statusText:r.getStatusText(302),headers:{Location:e,...o.headers},body:void 0,bodyType:"None"}}static defaultOptions(e,t){let o={...D,...t};return o.headers={"Content-Type":b[e],...o.headers},o}static getStatusText(e){let t=O[e];if(!t)throw new Error(`Status code "${e}" is invalid.`);return t}};var C={New:h,Load:f};function F(r,e){return i.JSON({request:r,context:e},{status:201})}function G(r,e){return i.JSON({request:r,context:e},{status:201})}function q(r,e){return i.JSON({request:r,context:e},{status:201})}function k(r,e){return i.JSON({request:r,context:e},{status:201})}function Q(r,e){return i.JSON({request:r,context:e},{status:201})}var I=C.New.server({context:"foo"});var X=I.context,$=[{name:"regular",isDynamic:!1}];async function v(r,e){let t=await y.RequestTransform.Vercel(r,$),o=await y.Handler(S,X,t);return y.ResponseTransform.Vercel(o)}
// Generated by SherpaJS
